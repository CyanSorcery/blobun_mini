function obj_create(_str)local _obj={type=subl(_str,1,1),x=subl(_str,2,1),y=subl(_str,3,1),spr=subl(_str,4,1,1),anim=rnd(),spin=rnd()}_obj.poskey=_obj.x<<4|_obj.y if _obj.type==0then _obj.startx,_obj.starty,_obj.poskey,_obj.dir,_obj.anim,_obj.jiggle,_obj.sprint,_obj.pstate,_obj.ismove,_obj.oldx,_obj.oldy,_obj.startturnx,_obj.startturny,_obj.haskey,_obj.onconvey,_obj.inportal,_obj.blink,_obj.octogems,_obj.coins,_obj.nextdir,_obj.tilestouched,_obj.isdead,_obj.prevslimetrap,_obj.prevcrackedfloor=_obj.x,_obj.y,-1,3,1,0,false,0,false,_obj.x,_obj.y,_obj.x,_obj.y,false,false,false,10,0,0,-1,1,false,false,false _obj.onstep=player_step _obj.ondraw=player_draw else if(_obj.type==5)_obj.oct_ind=_obj.spr _obj.spr=87
if(_obj.type==10)_obj.dst_x,_obj.dst_y=subl(_str,4,1),subl(_str,5,1)
function _obj:onstep()if self.type<10then self.anim+=.02self.anim%=1self.spin+=.035self.spin%=1end end function _obj:ondraw()local _w_x,_w_y=(self.x<<4)+8,self.y<<4if self.type<9then if self.oct_ind==nil or self.oct_ind==g_list_obj[1].octogems then local _y,_sx,_sy,_modx=_w_y+sin(self.anim)*2,self.spr%16<<3,self.spr\16<<3,ceil(sin(self.spin*.5)*-8)if(_modx<=3)rectfill(_w_x+7,_y+1,_w_x+9,_y+14,7)
sspr(_sx,_sy,8,16,_w_x+9-_modx,_y,_modx,16)sspr(_sx,_sy,8,16,_w_x+8,_y,_modx,16,true)end elseif self.type<10then spr(self.spr,_w_x+4,_w_y+sin(self.anim)*2,1,2)end end end return _obj end